<?xml version="1.0" encoding="UTF-8"?>
<l7:layer7-config xmlns:l7="http://l7.security.css.ch/config" xmlns:env="http://l7.security.css.ch/environment" xmlns:srv="http://l7.security.css.ch/service"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://l7.security.css.ch/config layer7-config.xsd">

   <env:environment name="dev">
      <env:cell>test</env:cell>
      <env:mandant>integration</env:mandant>
   </env:environment>

   <srv:restService name="Crypto-API" version="1" releaseUnit="eb-es-frv-srv-web" serviceGroup="Layer7-Deploy-Tool">

      <srv:audit>
         <srv:saveRequest>true</srv:saveRequest>
         <srv:saveResponse>true</srv:saveResponse>
         <srv:fullFaultDetails>false</srv:fullFaultDetails>
      </srv:audit>

      <srv:proxy passthroughHttpAuthentication="false" readTimeout="60000">
         <srv:publications>
            <srv:publication>
               <srv:publishedPath>/sample/anzu/v1/crypto/*</srv:publishedPath>
               <srv:backendPath>/eb-es-frv-srv-web${request.http.uri}</srv:backendPath>
            </srv:publication>
         </srv:publications>
         <srv:currentSecurityHeaderHandling>3</srv:currentSecurityHeaderHandling>
         <srv:backendHosts>
            <srv:backendHost>ced36.css.ch</srv:backendHost>
         </srv:backendHosts>
      </srv:proxy>

      <srv:protection>
         <srv:requestSize limit="4098" />
      </srv:protection>

      <srv:resources>
      
         <srv:resource name="ENCRPYT" match="^/sample/anzu/v1/crypto/encrypt$">
            <srv:validation>
               <srv:inbound file="encrypt-schema-in.json" />
               <srv:outbound file="encrypt-schema-out.json" status="200" />
            </srv:validation>
            <srv:authentication>NONE</srv:authentication>
            <srv:http-methods>
               <srv:http-method>POST</srv:http-method>
            </srv:http-methods>
         </srv:resource>
         
         <srv:resource name="DECRYPT" match="^/sample/anzu/v1/crypto/decrypt$">
            <srv:validation>
               <srv:inbound file="encrypt-schema-in.json" />
               <!-- Validation allows multiple outputs -->
               <srv:outbound file="encrypt-schema-out.json" status="200" />
               <srv:outbound file="encrypt-schema-out.json" status="208" />
               <srv:outbound status="303" />
            </srv:validation>
            <srv:authentication>NONE</srv:authentication>
            <srv:http-methods>
               <srv:http-method>POST</srv:http-method>
            </srv:http-methods>
         </srv:resource>
         <!-- preflight requests -->
         <srv:resource name="ENCRPYT_OPTIONS" match="^/sample/anzu/v1/crypto/encrypt$">
            <!-- Validation defines an empty response body with status code 200 -->
            <srv:validation>
               <srv:outbound status="200" />
            </srv:validation>
            <srv:authentication>NONE</srv:authentication>
            <srv:http-methods>
               <srv:http-method>OPTIONS</srv:http-method>
            </srv:http-methods>
         </srv:resource>
         <srv:resource name="DECRYPT_OPTIONS" match="^/sample/anzu/v1/crypto/decrypt$">
            <!-- Validation is disabled -->
            <srv:validation />
            <srv:authentication>NONE</srv:authentication>
            <srv:http-methods>
               <srv:http-method>OPTIONS</srv:http-method>
            </srv:http-methods>
         </srv:resource>
      </srv:resources>
   </srv:restService>
</l7:layer7-config>
